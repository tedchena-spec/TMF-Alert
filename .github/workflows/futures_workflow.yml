name: 微台指監控
on:
  workflow_dispatch:
    inputs:
      force_session:
        description: '強制時段 (DAY / NIGHT / 留空=自動判斷)'
        required: false
        default: ''
  schedule:
    # =============================================
    # 日盤（台指期 08:45~13:45）
    # =============================================
    - cron: '48 0 * * 1-5'   # 台灣 08:48
    - cron: '33 3 * * 1-5'   # 台灣 11:33
    - cron: '20 5 * * 1-5'   # 台灣 13:20（提早避免延遲超過 13:45）
    # =============================================
    # 夜盤（台指期 15:00~05:00 隔日）
    # =============================================
    - cron: '15 7 * * 1-5'   # 台灣 15:15（延後避免提早落在 CLOSED）
    - cron: '48 13 * * 1-5'  # 台灣 21:48
    - cron: '48 20 * * 0-4'  # 台灣 04:48
jobs:
  futures-monitor:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Taipei
    steps:
      - name: 下載程式碼
        uses: actions/checkout@v4
      - name: 設定 Python 環境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: 安裝套件
        run: pip install -r requirements-futures.txt
      - name: 執行微台指監控
        env:
          LINE_TOKEN:    ${{ secrets.LINE_TOKEN }}
          LINE_USER_ID:  ${{ secrets.LINE_USER_ID }}
          FORCE_SESSION: ${{ github.event.inputs.force_session }}
        run: python futures_monitor.py
